!function(b,l,p,m){function k(a){this.route=a;this.keys=[];this.regex=d.regexRoute(a,this.keys)}class d{constructor(a){var c=this;this.events={};this.state=null;this.options=a||{};this.options.env=this.options.env||(0===Object.keys(b).length&&process&&!0!==process.browser?"server":"client");this.options.mode=this.options.mode||("server"!==this.options.env&&this.options.pushState&&b.history&&b.history.pushState?"pushState":"hashchange");this.version="0.6.3";"function"===typeof b.addEventListener&&
(b.addEventListener("hashchange",function(){c.trigger("hashchange")}),b.addEventListener("popstate",function(a){if(c.state&&null===c.state.previousState)return!1;c.trigger("navigate")}));return this}}d.regexRoute=function(a,c,e,g){if(a instanceof RegExp)return a;a instanceof Array&&(a="("+a.join("|")+")");a=a.concat(g?"":"/?").replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(a,e,g,d,b,f){c.push({name:d,optional:!!f});e=e||"";return""+(f?"":
e)+"(?:"+(f?e:"")+(g||"")+(b||g&&"([^/.]+?)"||"([^/]+?)")+")"+(f||"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)");return new RegExp("^"+a+"$",e?"":"i")};d._forEach=function(a,c){if("function"===typeof Array.prototype.forEach)return Array.prototype.forEach.call(a,c);for(var e=0,g=a.length;e<g;++e)c.call(void 0,a[e],e,a)};d.prototype.get=d.prototype.add=function(a){var c=this,e=Array.prototype.slice.call(arguments,1,-1),g=Array.prototype.slice.call(arguments,-1)[0],
d=new k(a),b=function(){var b=d.parse(c.path());if(b.match){var h=(new f(c,{route:a,params:b.params,req:b,regex:b.match})).enqueue(e.concat(g));c.trigger("match",h,b);if(!h.runCallback)return c;h.previousState=c.state;c.state=h;if(h.parent()&&!1===h.parent().propagateEvent)return h.propagateEvent=!1,c;h.callback()}return c},n="pushState"!==c.options.mode&&"server"!==c.options.env?"hashchange":"navigate";return b().on(n,b)};d.prototype.trigger=function(a){var c=this,e=Array.prototype.slice.call(arguments,
1);this.events[a]&&d._forEach(this.events[a],function(a){a.apply(c,e)});return this};d.prototype.on=d.prototype.bind=function(a,c){var e=this;a=a.split(" ");d._forEach(a,function(a){e.events[a]?e.events[a].push(c):e.events[a]=[c]});return this};d.prototype.once=function(a,c){var e=!1;return this.on(a,function(){if(e)return!1;e=!0;c.apply(this,arguments);c=null;return!0})};d.prototype.context=function(a){var c=this,e=Array.prototype.slice.call(arguments,1);return function(){var b=arguments[0],d=2<
arguments.length?Array.prototype.slice.call(arguments,1,-1):[],f=Array.prototype.slice.call(arguments,-1)[0],k="/"!==a.slice(-1)&&"/"!==b&&""!==b?a+"/":a;b="/"!==b.substr(0,1)?b:b.substr(1);return c.add.apply(c,[k+b].concat(e).concat(d).concat([f]))}};d.prototype.navigate=function(a){return this.path(a).trigger("navigate")};d.prototype.path=function(a){if("string"===typeof a)return"pushState"===this.options.mode?(a=this.options.root?this.options.root+a:a,b.history.pushState({},null,a)):b.location?
b.location.hash=(this.options.hashBang?"!":"")+a:b._pathname=a||"",this;if("undefined"===typeof a)return a="pushState"===this.options.mode?b.location.pathname.replace(this.options.root,""):"pushState"!==this.options.mode&&b.location?b.location.hash?b.location.hash.split(this.options.hashBang?"#!":"#")[1]:"":b._pathname||"";if(!1===a)return"pushState"===this.options.mode?b.history.pushState({},null,this.options.root||"/"):b.location&&(b.location.hash=this.options.hashBang?"!":""),this};d.listen=function(a,
c){if(a&&c){var b=a;a=c}b=new d(b||{});for(var f in a)b.add.call(b,f,a[f]);return b};class f{constructor(a,c){this.stack=f.global.slice(0);this.router=a;this.runCallback=!0;this.callbackRan=!1;this.propagateEvent=!0;this.value=a.path();for(var b in c)this[b]=c[b];return this}}f.global=[];f.prototype.preventDefault=function(){this.runCallback=!1};f.prototype.stopPropagation=function(){this.propagateEvent=!1};f.prototype.parent=function(){return this.previousState&&this.previousState.value&&this.previousState.value==
this.value?this.previousState:!1};f.prototype.callback=function(){this.callbackRan=!0;this.timeStamp=Date.now();this.next()};f.prototype.enqueue=function(a,b){for(a=Array.isArray(a)?b<a.length?a.reverse():a:[a];a.length;)this.stack.splice(b||this.stack.length+1,0,a.shift());return this};f.prototype.next=function(){var a=this;return this.stack.shift().call(this.router,this.req,this,function(){a.next.call(a)})};k.prototype.parse=function(a){a=a.match(this.regex);var b=this,e={params:{},keys:this.keys,
matches:(a||[]).slice(1),match:a};d._forEach(e.matches,function(a,c){e.params[b.keys[c]&&b.keys[c].name?b.keys[c].name:c]=a?decodeURIComponent(a):m});return e};d.CallStack=f;d.Request=k;"function"===typeof define&&define.amd?define(function(){return d}):"object"===typeof module&&module.exports?module.exports=d:"undefined"==typeof $_&&(l.Grapnel=d)}.call({},"object"===typeof window?window:this,window,document);