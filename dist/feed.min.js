function postAjax(g,f,c){var b="string"==typeof f?f:Object.keys(f).map(function(a){return encodeURIComponent(a)+"="+encodeURIComponent(f[a])}).join("&"),a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.open("POST",g);a.onreadystatechange=function(){3<a.readyState&&200==a.status&&c(a.responseText)};a.setRequestHeader("X-Requested-With","XMLHttpRequest");a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");a.send(b);return a}
function sleep(g){return new Promise(f=>setTimeout(f,g))}
function post(){if(40>document.getElementById("enc").value.length)throw document.getElementById("msg").innerHTML="Please write more...","not written enough text";document.getElementById("post").disabled=!0;document.getElementById("msg").innerHTML="Posting....";sleep(2500).then(()=>{var g=document.getElementById("enc").value,f=document.getElementById("pwd").value,c=document.getElementById("track").checked,b=0<f.length;try{var a=do_enc("xor","des",g,f),d=get_styles(),e=document.getElementById("tags").value;
postAjax("do_post.php",{enc:a,pass:b,style:d,tags:e,track:c},function(a){a=JSON.parse(a);if(a.hasOwnProperty("Failed"))document.getElementById("msg").innerHTML=a.Failed;else if(a.hasOwnProperty("Error"))document.getElementById("msg").innerHTML=a.Error;else if(a.hasOwnProperty("Success")&&a.hasOwnProperty("id")){var b=a.id,c=window.location.href.replace("post.php","").replace("index.php",""),d="";a.hasOwnProperty("ds")&&(d="/"+a.ds);a=a.Success+". Your Link is: "+c+b+d;document.getElementById("msg").innerHTML=
a;document.getElementById("post").disabled=!1;document.getElementById("enc").value=""}})}catch(h){"undefined"!=typeof h.message?(console.warn(h.message),alert(h.message)):(console.warn(h),alert(h)),document.getElementById("post").disabled=!1,document.getElementById("msg").innerHTML=""}})}
function feed_fetch(g,f){postAjax("do_fetch.php",{id:g},function(c){document.getElementById("wait").innerHTML="";var b=JSON.parse(c);if(b.hasOwnProperty("Failed")){c=document.getElementById("feed_update_list");var a=document.createElement("li");a.innerHTML=b.Failed;c.appendChild(a)}else if(b.hasOwnProperty("approved")&&"N"===b.approved){c=document.getElementById("feed_update_list");a=document.createElement("li");var d="";if(b.hasOwnProperty("flags")&&3<b.flags.length){b=JSON.parse(b.flags);for(var e in b)d+=
" - ("+b[e]+") Flagged as "+e+" abuse."}a.innerHTML="Sorry, that message was BANNED! "+d;c.appendChild(a)}else if(!1===b)c=document.getElementById("feed_update_list"),a=document.createElement("li"),a.innerHTML="No Message Found!",c.appendChild(a);else{c="";if(b.hasOwnProperty("has_pwd")&&"Y"===b.has_pwd){a=document.getElementById("password");e=document.getElementById("pwd");if("undefined"!=typeof a&&null!=a&&"none"===a.style.display)throw a.style.display="block","Needs password";"undefined"!=typeof e&&
null!=e&&(c=e.value)}e="";b.hasOwnProperty("ds")&&""!==f&&(a=b.ds,e="Original Message was lost! This may not be the intended message the user wanted to share/post, anymore.",a===f&&(e="Message confirmed to match verification code. This is the intended message, user wanted to share/post."));d="";b.hasOwnProperty("style")&&(d=b.style);if(b.hasOwnProperty("cypher")){var g=do_dec(b.cypher,c).replace(/(?:\r\n|\r|\n)/g,"<br>");c=document.getElementById("feed_update_list");a=document.createElement("li");
a.style=d;a.innerHTML=g.trim();c.appendChild(a);""!==e&&(a=document.createElement("div"),a.innerHTML=e,c.appendChild(a));a="";b.hasOwnProperty("ds")&&(a="/"+b.ds);b.hasOwnProperty("id")&&(b="<br>"+("<button onclick='btn_report(\""+b.id+"\");'>Report Abuse</button>")+" ** The Shared Link for this message is &nbsp; &nbsp; "+mysite+b.id+a,a=document.createElement("span"),a.innerHTML=b,c.appendChild(a));b=document.createElement("hr");b.className="feedhr";c.appendChild(b)}else document.getElementById("wait").innerHTML=
"No Results Found"}})}
function feed_fetchs(g,f){postAjax("do_fetchs.php",{page:g,limit:f},function(c){document.getElementById("wait").innerHTML="";c=JSON.parse(c);if(c.hasOwnProperty("Failed")){var b=document.getElementById("feed_update_list"),a=document.createElement("li");a.innerHTML=c.Failed;b.appendChild(a)}else if(!1===c)b=document.getElementById("feed_update_list"),a=document.createElement("li"),a.innerHTML="No more Messages Found!",b.appendChild(a);else for(var d=0;d<c.length;d++){var e="";c[d].hasOwnProperty("style")&&
(e=c[d].style);if(c[d].hasOwnProperty("cypher")){var f=do_dec(c[d].cypher,"").replace(/(?:\r\n|\r|\n)/g,"<br>");b=document.getElementById("feed_update_list");a=document.createElement("li");var g="";c[d].hasOwnProperty("ds")&&(g="/"+c[d].ds);a.style=e;a.innerHTML=f.trim();b.appendChild(a);c[d].hasOwnProperty("id")&&(a="<br>"+("<button onclick='btn_report(\""+c[d].id+"\");'>Report Abuse</button>")+" ** The Shared Link for this message is &nbsp; &nbsp; "+mysite+c[d].id+g,e=document.createElement("span"),
e.innerHTML=a,b.appendChild(e));a=document.createElement("hr");a.className="feedhr";b.appendChild(a)}}})};