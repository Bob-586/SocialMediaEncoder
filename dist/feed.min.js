function postAjax(b,e,c){var d="string"==typeof e?e:Object.keys(e).map(function(a){return encodeURIComponent(a)+"="+encodeURIComponent(e[a])}).join("&"),a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.open("POST",b);a.onreadystatechange=function(){3<a.readyState&&200==a.status&&c(a.responseText)};a.setRequestHeader("X-Requested-With","XMLHttpRequest");a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");a.send(d);return a}
function sleep(b){return new Promise(e=>setTimeout(e,b))}
function post(){if(40>document.getElementById("enc").value.length)throw document.getElementById("msg").innerHTML="Please write more...","not written enough text";document.getElementById("post").disabled=!0;document.getElementById("msg").innerHTML="Posting....";sleep(2500).then(()=>{var b=document.getElementById("enc").value,e=document.getElementById("pwd").value,c=0<e.length;try{var d=do_enc("xor","des",b,e);postAjax("do_post.php",{enc:d,pass:c},function(a){a=JSON.parse(a);if(a.hasOwnProperty("Failed"))document.getElementById("msg").innerHTML=
a.Failed;else if(a.hasOwnProperty("Success")&&a.hasOwnProperty("id")){var c=a.id,d=window.location.href.replace("post.php","").replace("index.php",""),b="";a.hasOwnProperty("ds")&&(b="/"+a.ds);a=a.Success+". Your Link is: "+d+c+b;document.getElementById("msg").innerHTML=a;document.getElementById("post").disabled=!1;document.getElementById("enc").value=""}})}catch(a){"undefined"!=typeof a.message?(console.warn(a.message),alert(a.message)):(console.warn(a),alert(a)),document.getElementById("post").disabled=
!1,document.getElementById("msg").innerHTML=""}})}
function feed_fetch(b,e){postAjax("do_fetch.php",{id:b},function(c){document.getElementById("wait").innerHTML="";c=JSON.parse(c);if(c.hasOwnProperty("Failed")){var d=document.getElementById("feed_update_list"),a=document.createElement("li");a.innerHTML=c.Failed;d.appendChild(a)}else if(!1===c)d=document.getElementById("feed_update_list"),a=document.createElement("li"),a.innerHTML="No Message Found!",d.appendChild(a);else{d="";if(c.hasOwnProperty("has_pwd")&&"Y"===c.has_pwd){var b=document.getElementById("password");
a=document.getElementById("pwd");if("undefined"!=typeof b&&null!=b&&"none"===b.style.display)throw b.style.display="block","Needs password";"undefined"!=typeof a&&null!=a&&(d=a.value)}b="";c.hasOwnProperty("ds")&&""!==e&&(a=c.ds,b="<br><br>Original Message was lost! This may not be the intended message the user wanted to share/post, anymore.",a===e&&(b="<br><br>Message confirmed to match verification code. This is the intended message, user wanted to share/post."));c.hasOwnProperty("cypher")?(c=do_dec(c.cypher,
d).replace(/(?:\r\n|\r|\n)/g,"<br>"),d=document.getElementById("feed_update_list"),a=document.createElement("li"),a.innerHTML=(c+b).trim(),d.appendChild(a),c=document.createElement("hr"),d.appendChild(c)):document.getElementById("wait").innerHTML="No Results Found"}})}
function feed_fetchs(){postAjax("do_fetchs.php",{},function(b){document.getElementById("wait").innerHTML="";b=JSON.parse(b);if(b.hasOwnProperty("Failed")){var e=document.getElementById("feed_update_list"),c=document.createElement("li");c.innerHTML=b.Failed;e.appendChild(c)}else if(!1===b)e=document.getElementById("feed_update_list"),c=document.createElement("li"),c.innerHTML="No Messages Found!",e.appendChild(c);else for(var d=0;d<b.length;d++)if(b[d].hasOwnProperty("cypher")){var a=do_dec(b[d].cypher,
"").replace(/(?:\r\n|\r|\n)/g,"<br>");e=document.getElementById("feed_update_list");c=document.createElement("li");var f="";b[d].hasOwnProperty("ds")&&(f="/"+b[d].ds);b[d].hasOwnProperty("id")&&(f="<br><br> ** The Shared Link for this message is &nbsp; &nbsp; "+window.location.href.replace("index.php","")+b[d].id+f,a+=f);c.innerHTML=a.trim();e.appendChild(c);c=document.createElement("hr");e.appendChild(c)}})};